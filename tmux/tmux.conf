# ==============================================================================
# TMUX Configuration - German Keyboard Layout
# ==============================================================================

# ==============================================================================
# BASIC SETTINGS
# ==============================================================================

# Change prefix from default Ctrl+b to Ctrl+a
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Reload configuration with Prefix + r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Set history limit to 10,000 lines
set -g history-limit 10000

# Reduce escape time for faster response (0ms)
set -sg escape-time 0

# Enable 256 colors
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color*:Tc"

# Enable focus events for better Vim integration
set -g focus-events on

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# ==============================================================================
# WINDOW MANAGEMENT
# ==============================================================================

# Create new window with German character ß (Prefix + ß)
bind ß new-window

# Window navigation with Option (Alt) + H/L (German keyboard shortcuts)
bind -n M-h previous-window
bind -n M-l next-window

# Direct window access with Option (Alt) + numbers 1-9
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Close pane with Prefix + x (default)
# Close window with Prefix + X
bind X confirm-before -p "kill-window #W? (y/n)" kill-window

# ==============================================================================
# PANE MANAGEMENT
# ==============================================================================

# Split panes with German umlauts
# Horizontal split with ü (Prefix + ü)
bind ü split-window -h

# Vertical split with ö (Prefix + ö)
bind ö split-window -v

# Alternative splits (default tmux bindings)
bind '"' split-window -v
bind % split-window -h

# Vim-style pane navigation (Prefix + h/j/k/l)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing with German characters and Option + arrows
# With German umlauts/characters
bind ä resize-pane -L 5    # Left smaller
bind + resize-pane -R 5    # Right bigger  
bind ^ resize-pane -U 5    # Up bigger
bind - resize-pane -D 5    # Down bigger

# With Option + arrow keys for easier access
bind -n M-Left resize-pane -L 5
bind -n M-Right resize-pane -R 5
bind -n M-Up resize-pane -U 5
bind -n M-Down resize-pane -D 5

# Display pane numbers (Prefix + q) - default binding is fine

# ==============================================================================
# SESSION MANAGEMENT
# ==============================================================================

# Session selection with Prefix + Ctrl + s
bind C-s choose-session

# Window selection with Prefix + Ctrl + w  
bind C-w choose-window

# Tree view with Prefix + Ctrl + p
bind C-p choose-tree

# ==============================================================================
# COPY MODE (VIM-STYLE)
# ==============================================================================

# Enable vi mode
setw -g mode-keys vi

# Start copy mode with Prefix + v
bind v copy-mode

# Vim-style copy mode bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# ==============================================================================
# MOUSE SUPPORT
# ==============================================================================

# Enable mouse support
set -g mouse on

# ==============================================================================
# PLUGIN MANAGER (TPM)
# ==============================================================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'christoomey/vim-tmux-navigator'
# set -g @plugin 'dracula/tmux'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# ==============================================================================
# NORDIC THEME CONFIGURATION
# ==============================================================================

# Source Nordic theme configuration
source-file ~/.dotfiles/tmux/nordic-theme.conf

# ==============================================================================
# DRACULA THEME CONFIGURATION (DISABLED)
# ==============================================================================
# Commented out - using Nordic theme instead
#
# # Position status bar at top
# set -g status-position top
#
# # Dracula theme settings
# set -g @dracula-show-weather true
# set -g @dracula-show-location true
# set -g @dracula-show-fahrenheit false
# set -g @dracula-fixed-location "Sigmarszell"
# set -g @dracula-military-time true
# set -g @dracula-show-timezone false
# set -g @dracula-day-month true
# set -g @dracula-show-left-icon session
#
# # Enable powerline symbols
# set -g @dracula-show-powerline true
#
# # Enable window flags
# set -g @dracula-show-flags true
#
# # Refresh rate (in seconds)
# set -g @dracula-refresh-rate 5
#
# # Enable high contrast pane borders
# set -g @dracula-border-contrast true
#
# # Configure plugins to show
# set -g @dracula-plugins "cpu-usage ram-usage weather time"
#
# # Additional customization options
# # set -g @dracula-show-empty-plugins false
# # set -g @dracula-left-icon-padding 1
# # set -g @dracula-show-edge-icons false
#
# # Battery settings (if using battery plugin)
# # set -g @dracula-battery-label "⚡"
# # set -g @dracula-show-battery-status true
#
# # Git settings (if using git plugin)
# # set -g @dracula-git-disable-status false
# # set -g @dracula-git-show-current-symbol ✓
# # set -g @dracula-git-show-diff-symbol ↕
#
# # GPU settings (if using gpu plugin)
# # set -g @dracula-gpu-vram-percent true
# # set -g @dracula-gpu-power-percent true
#
# # Mac player settings (if on macOS)
# # set -g @dracula-mac-player-remote false
# # set -g @dracula-mac-player-app "Music"

# ==============================================================================
# TMUX RESURRECT CONFIGURATION
# ==============================================================================

# Restore vim sessions
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Restore additional programs
set -g @resurrect-processes 'ssh vim nvim'

# Session restore bindings
bind C-r run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'
bind S run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'

# ==============================================================================
# TMUX CONTINUUM CONFIGURATION
# ==============================================================================

# Enable automatic restore
set -g @continuum-restore 'on'

# Set save interval to 15 minutes
set -g @continuum-save-interval '15'

# ==============================================================================
# ADDITIONAL SETTINGS
# ==============================================================================

# Don't exit copy mode after copying
set -g @yank_action 'copy-pipe'

# Increase display time for pane numbers
set -g display-panes-time 2000

# Set window notifications
setw -g monitor-activity on
set -g visual-activity on

# ==============================================================================
# STATUSLINE CUSTOMIZATION (if not using Dracula)
# ==============================================================================

# Uncomment these if you want custom statusline instead of Dracula
# set -g status-left-length 40
# set -g status-right-length 80
# set -g status-left "#[fg=green]Session: #S #[fg=yellow]Window: #I #[fg=cyan]Pane: #P"
# set -g status-right "#[fg=cyan]%d %b %R"
# set -g status-justify centre

# ==============================================================================
# INITIALIZE TMUX PLUGIN MANAGER
# ==============================================================================

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

# ==============================================================================
# PLUGIN INSTALLATION COMMANDS
# ==============================================================================
# 
# To install plugins:
# 1. Install TPM first: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# 2. Reload tmux config: tmux source ~/.tmux.conf
# 3. Install plugins: Prefix + I
# 4. Update plugins: Prefix + U  
# 5. Remove plugins: Prefix + Alt + u
#
# ==============================================================================
